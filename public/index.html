<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Vision IA pour Dirigeants</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-2xl mx-auto">
        <!-- Écran d'accueil -->
        <div id="welcome-screen" class="bg-white p-8 rounded-xl shadow-lg text-center fade-in">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Définissez Votre Vision de l'IA</h1>
            <p class="text-gray-600 mb-6">Un guide interactif pour vous aider à formuler la stratégie IA de votre entreprise.</p>
            <div class="mb-6">
                <label for="name-input" class="block text-sm font-medium text-gray-700 mb-2 text-left">Votre nom complet</label>
                <input type="text" id="name-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Ex: Jean Dupont">
            </div>
            <button id="start-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Commencer
            </button>
        </div>
        <!-- Écran des questions -->
        <div id="question-screen" class="hidden fade-in">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <div class="mb-6">
                    <p id="progress-indicator" class="text-sm font-medium text-blue-600">Question 1 sur 15</p>
                    <h2 id="question-text" class="text-xl font-semibold text-gray-900 mt-2"></h2>
                </div>
                <textarea id="answer-textarea" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="5" placeholder="Votre réponse ici..."></textarea>
                <div id="navigation-buttons" class="flex justify-between mt-6">
                    <button id="prev-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition">Précédent</button>
                    <button id="next-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Suivant</button>
                </div>
            </div>
        </div>
        <!-- Écran de génération et de validation -->
        <div id="vision-screen" class="hidden fade-in">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Proposition de Vision IA</h2>
                 <p class="text-gray-600 mb-6">Voici une proposition synthétisée à partir de vos réponses. Vous pouvez la modifier directement dans le champ ci-dessous, la régénérer ou la valider pour la télécharger.</p>
                <div id="loader-container" class="flex flex-col items-center justify-center h-48">
                    <div class="loader"></div>
                    <p class="mt-4 text-gray-600">Génération de votre vision en cours...</p>
                </div>
                
                <div id="vision-content" class="hidden">
                    <textarea id="vision-textarea" class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition mb-4" placeholder="Votre vision apparaîtra ici..."></textarea>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="regenerate-btn" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition">Régénérer</button>
                        <button id="validate-btn" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition">Valider cette version</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Écran de téléchargement -->
        <div id="download-screen" class="hidden fade-in">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <svg class="mx-auto h-12 w-12 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-900 mt-4 mb-2">Vision Validée !</h2>
                <p class="text-gray-600 mb-6">Votre document est prêt à être téléchargé.</p>
                <button id="download-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Télécharger le document (.pdf)
                </button>
                 <button id="restart-btn" class="w-full mt-4 bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition">
                    Recommencer
                </button>
            </div>
        </div>
    </div>
<script>
    const questions = [
        "Pour vous est-il possible aujourd'hui pour une entreprise de laisser l'IA de côté ?",
        "Pourquoi ?",
        "Pensez-vous que vos clients, vos fournisseurs ou vos concurrents utilisent déjà l'IA ?",
        "Ce que l'IA permet, ses fonctionnalités et leurs utilités pour une entreprise telle que la vôtre ?",
        "Pensez-vous que les fonctionnalités de l'IA vont continuer à évoluer ? À quelle vitesse ?",
        "En vous projetant dans 10 ans, comment imaginez-vous les entreprises telles que les vôtres compte tenu de l'évolution de l'IA ?",
        "Quelles opportunités représente cette technologie pour votre organisation ?",
        "En quoi ces opportunités peuvent faciliter ou accélérer la réalisation de vos enjeux stratégiques ?",
        "Ce que vous pourriez craindre face à l'évolution et la propagation de cette technologie ?",
        "Ce que vous ne voulez pas qu'il se produise en intégrant l'IA dans votre organisation",
        "Quelle(s) application(s) vous semblent pertinentes pour votre entreprise dans un 1er temps ?",
        "Pourquoi ?",
        "Quelle(s) application(s) pourraient avoir une forte valeur ajoutée à plus long terme ?",
        "Quel(s) type(s) de solution IA vous paraissent les plus adaptées à vos enjeux ? (opensource, propriétaire, sur vos serveurs, dans le cloud, intégrés à vos logiciels, à vos produits...)",
        "Quelles sont les actions à mener pour réussir vos projets d'intégration de l'IA ?"
    ];
    let currentQuestionIndex = 0;
    let userName = "";
    const answers = new Array(questions.length).fill("");
    let finalVision = "";
    const welcomeScreen = document.getElementById('welcome-screen');
    const questionScreen = document.getElementById('question-screen');
    const visionScreen = document.getElementById('vision-screen');
    const downloadScreen = document.getElementById('download-screen');
    
    const nameInput = document.getElementById('name-input');
    const startBtn = document.getElementById('start-btn');
    
    const progressIndicator = document.getElementById('progress-indicator');
    const questionText = document.getElementById('question-text');
    const answerTextarea = document.getElementById('answer-textarea');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const loaderContainer = document.getElementById('loader-container');
    const visionContent = document.getElementById('vision-content');
    const visionTextarea = document.getElementById('vision-textarea');
    const regenerateBtn = document.getElementById('regenerate-btn');
    const validateBtn = document.getElementById('validate-btn');
    
    const downloadBtn = document.getElementById('download-btn');
    const restartBtn = document.getElementById('restart-btn');
    function showScreen(screen) {
        welcomeScreen.classList.add('hidden');
        questionScreen.classList.add('hidden');
        visionScreen.classList.add('hidden');
        downloadScreen.classList.add('hidden');
        screen.classList.remove('hidden');
    }
    function displayQuestion() {
        if (currentQuestionIndex < questions.length) {
            progressIndicator.textContent = `Question ${currentQuestionIndex + 1} sur ${questions.length}`;
            questionText.textContent = questions[currentQuestionIndex];
            answerTextarea.value = answers[currentQuestionIndex];
            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.classList.toggle('opacity-50', currentQuestionIndex === 0);
            nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? "Générer la vision" : "Suivant";
        }
    }
    
    startBtn.addEventListener('click', () => {
        userName = nameInput.value.trim();
        if (userName === "") {
            alert("Veuillez entrer votre nom.");
            return;
        }
        showScreen(questionScreen);
        displayQuestion();
    });
    prevBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            answers[currentQuestionIndex] = answerTextarea.value.trim();
            currentQuestionIndex--;
            displayQuestion();
        }
    });
    nextBtn.addEventListener('click', () => {
        answers[currentQuestionIndex] = answerTextarea.value.trim();
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
        } else {
            generateVision();
        }
    });
    async function generateVision() {
        showScreen(visionScreen);
        loaderContainer.classList.remove('hidden');
        visionContent.classList.add('hidden');

        const payload = {
            userName,
            answers,
            questions
        };

        try {
            const response = await fetch("http://localhost:3001/api/gemini", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`Erreur API: ${response.statusText}`);
            }
            const result = await response.json();
            const candidate = result.candidates?.[0];
            if (candidate && candidate.content?.parts?.[0]?.text) {
                finalVision = candidate.content.parts[0].text;
                visionTextarea.value = finalVision;
            } else {
                visionTextarea.value = "Désolé, une erreur est survenue lors de la génération de la vision. Veuillez réessayer.";
            }
        } catch(error) {
            console.error("Erreur lors de l'appel au backend Gemini:", error);
            visionTextarea.value = "Impossible de se connecter au service de génération. Vérifiez votre connexion et réessayez.";
        } finally {
            loaderContainer.classList.add('hidden');
            visionContent.classList.remove('hidden');
        }
    }
    
    regenerateBtn.addEventListener('click', generateVision);
    
    validateBtn.addEventListener('click', () => {
        finalVision = visionTextarea.value;
        showScreen(downloadScreen);
    });
    downloadBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const docTitle = "Vision Stratégique sur l'Intelligence Artificielle";
        const dirigente = `Dirigeant: ${userName}`;
        const date = `Date: ${new Date().toLocaleDateString('fr-FR')}`;
        const footer = "Document généré par l'application \"Générateur de Vision IA\".";
        const separator = "--------------------------------------------------";
        let y = 20;
        const margin = 15;
        const pageWidth = doc.internal.pageSize.getWidth();
        const usableWidth = pageWidth - margin * 2;
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(18);
        doc.text(docTitle, pageWidth / 2, y, { align: 'center' });
        y += 15;
        
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(12);
        doc.text(separator, pageWidth / 2, y, { align: 'center' });
        y += 10;
        doc.setFont('helvetica', 'bold');
        doc.text(dirigente, margin, y);
        y += 7;
        doc.text(date, margin, y);
        y += 10;
        doc.setFont('helvetica', 'normal');
        doc.text(separator, pageWidth / 2, y, { align: 'center' });
        y += 15;
        
        const visionLines = doc.splitTextToSize(finalVision, usableWidth);
        doc.text(visionLines, margin, y);
        
        // Calculer la position pour le pied de page
        const pageHeight = doc.internal.pageSize.getHeight();
        const footerY = pageHeight - 25;
        doc.text(separator, pageWidth / 2, footerY, { align: 'center' });
        doc.setFontSize(9);
        doc.setTextColor(128);
        doc.text(footer, pageWidth / 2, footerY + 10, { align: 'center' });
        const safeFileName = userName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        doc.save(`Vision_IA_${safeFileName}.pdf`);
    });
    
    restartBtn.addEventListener('click', () => {
        // Reset state
        currentQuestionIndex = 0;
        userName = "";
        answers.fill("");
        finalVision = "";
        
        // Reset inputs
        nameInput.value = "";
        answerTextarea.value = "";
        visionTextarea.value = "";
        
        // Go to welcome screen
        showScreen(welcomeScreen);
    });
</script>
</body>
</html>
